<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Untitled Document</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onselectstart="return false;">
	<!--2、改写视图，为模板字符串-->
	<div class="wrap" id="wrap">
    	<!--photo 负责平移、旋转-->
        <div class="photo photo_front" id="photo_{{index}}" onClick="turn(this)">
        	<!--photo-wrap 负责翻转-->
        	<div class="photo-wrap">
              <div class="side side-front">
                  <p class="image"><img src="photo/{{img}}"/></p>
                  <p class="caption">{{caption}}</p>
              </div>
              <div class="side side-back">
                  <p class="desc">{{desc}}</p>
              </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="photo/data.js"></script>
    <script type="text/javascript">
	//1、翻面控制
    	function turn(elem){
			var a = elem.className;
			if(/photo_front/.test(a)){
				a = a.replace(/photo_front/,'photo_back');
				}
			else{
				a = a.replace(/photo_back/,'photo_front');
				}	
			return elem.className = a;
			}
	//随机生成一个值 支持取值范围 random([min,max]);
	function random(range){
		var min = Math.min(range[0],range[1]);
		var max= Math.max(range[0],range[1]);
		var diff = max - min;
		var number = Math.ceil(Math.random() * diff+ min);
		return number;
		}
	
	//3、通用函数
	function g(selector){
		var method = selector.substr(0,1) == '.' ? 'getElementsByClassName' : 'getElementById';
		return document[method](selector.substr(1));
		}
	//4、输出所有海报
	var data = data;
	function addPhoto(){
		var template = g('#wrap').innerHTML;
		var html = [];
		//6、输出控制按钮 每一个按钮对应一个海报
		var nav = [];
		for( s in data){
			var _html = template
						.replace('{{index}}',s)
						.replace('{{img}}',data[s].img)
						.replace('{{caption}}',data[s].caption)
						.replace('{{desc}}',data[s].desc);
			html.push(_html);
			nav.push('<span id = "nav_'+s+'" class = "i" onClick = "turn(g(\'#photo_'+s+'\'))">&nbsp;</span>');
			}
		html.push('<div class="nav">'+nav.join('')+'</div>');
		g('#wrap').innerHTML = html.join('');
		rsort(random([0,data.length]));
		}
	addPhoto();	
	//6、计算左右分区的范围 {left:{x[min,max],y[]},right{x[],y[]}}
	function range(){
		var range = {left:{x:[],y:[]},right:{x:[],y:[]}};
		var wrap = {
			w:g('#wrap').clientWidth,
			h:g('#wrap').clientHeight
			}
		var photo = {
			w:g('.photo')[0].clientWidth,
			h:g('.photo')[0].clientHeight		
			}
		range.left.x = [0-photo.w, wrap.w/2 - photo.w/2];
		range.left.y = [0-photo.h, wrap.h];
		range.right.x = [wrap.w/2 + photo.w/2, wrap.w + photo.w];
		range.right.y = [0-photo.h, wrap.h];
		return range;
		}
	
	//5、排序海报
	function rsort(n){
		//将除去某一个的所有photo的className中的'photo_center'取消
		var _photos = g('.photo');
		var photos = [];
		for(s = 0;s<_photos.length;s++){
			_photos[s].className.replace(/\s*photo_center\s*/,' ');
			photos.push(_photos[s]);
			}
		//把其中一个海报放在中间
		var photo_center = g('#photo_'+n);
		photo_center.className += ' photo_center ';
		//更改中间海报对应的按钮的className
		g('#nav_'+n).className += ' i-current ';
		photo_center = photos.splice(n,1)[0];//从photos数组中去掉水平垂直居中的（页面正中间的）那个海报
		//把除去显示在中间的所有海报分成左、右两个区域
		var photos_left = photos.splice(0,Math.ceil(photos.length/2));
		var photos_right = photos;
		console.log(photos_left.length, photos_right.length);
		var ranges = range();
		for(s in photos_left){
			var photo = photos_left[s];
			photo.style.top = random(range().left.y) + "px";
			photo.style.left = random(range().left.x) + "px";
			photo.style['-webkit-transform'] = 'rotate('+random([-150,150])+'deg)';
			}
		for(s in photos_right){
			var photo = photos_right[s];
			photo.style.top = random(range().right.y) + "px";
			photo.style.left = random(range().right.x) + "px";
			photo.style['-webkit-transform'] = 'rotate('+random([-150,150])+'deg)';
			}
		}	
    </script>
</body>
</html>
